<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto TirdzniecÄ«bas Simulators 3.1</title>
    <!-- Tailwind CSS for basic structure and utilities -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom CSS for a playful, kid-friendly look */
        :root {
            --primary-color: #FF5733; /* Bright Orange-Red (Sell) */
            --secondary-color: #33FF57; /* Bright Green (Buy) */
            --repair-color: #3399FF; /* Bright Blue (Repair) */
            --drive-color: #6A8EAE; /* Drive/Wait */
            --aggressive-color: #FF0000; /* Aggressive Drive */
            --careful-color: #10B981; /* Careful Drive */
            --card-bg: #FFFFFF;
            --font-family: 'Fredoka', sans-serif;
            --neutral-color: #6A8EAE;
        }

        body {
            font-family: var(--font-family);
            
            /* --- JAUNAIS FONS: tava rÄ«ku joslas bilde --- */
            /* PÄrliecinies, ka failu ieliec projektÄ: assets/hud-bg.png (vai nomaini ceÄ¼u zemÄk) */
            background-image: url('background.png');
            background-size: cover;
            background-attachment: fixed; 
            background-position: center;

            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 95%;
            width: 900px;
            background-color: var(--card-bg);
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); 
            padding: 25px;
            text-align: center;
            border: 6px solid var(--neutral-color);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1A1A1A; /* MainÄ«ts uz tumÅ¡u, lai kontrastÄ“tu ar gaiÅ¡o fonu */
            margin-bottom: 5px;
        }

        .info-bar {
            background: linear-gradient(90deg, #FFD700, #FFA500); 
            color: #1A1A1A;
            padding: 10px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.25rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .market-boom { 
            background: linear-gradient(90deg, #00FF00, #33FF57); 
            color: #1A1A1A; 
        }
        .market-crisis { 
            background: linear-gradient(90deg, #FF0000, #FF5733); 
            color: white; 
        }
        .market-normal { 
            background: linear-gradient(90deg, #EFEFEF, #CCCCCC); 
            color: #1A1A1A;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .car-card {
            background-color: #E6EFFF;
            padding: 15px;
            border-radius: 15px;
            border: 3px solid var(--repair-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .car-emoji {
            font-size: 3rem;
            margin: 5px 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .action-button {
            padding: 8px 10px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            transition: all 0.1s ease-in-out;
            box-shadow: 0 4px 0 0 rgba(0, 0, 0, 0.15);
            margin: 3px;
            flex-grow: 1;
            min-width: 90px;
        }

        .action-button:active {
            box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.15);
            transform: translateY(3px);
        }
        
        .buy-btn {
            background-color: var(--secondary-color);
            color: #1A1A1A;
            border: 2px solid #00AA00;
        }

        .sell-btn {
            background-color: var(--primary-color);
            color: white;
            border: 2px solid #CC3311;
        }

        .repair-btn {
            background-color: var(--repair-color);
            color: white;
            border: 2px solid #0066CC;
        }
        
        .wait-btn {
            background-color: var(--drive-color);
            color: white;
            border: 2px solid #5A7E9E;
        }
        .aggressive-btn {
            background-color: var(--aggressive-color);
            color: white;
            border: 2px solid #8B0000;
        }
        .careful-btn {
            background-color: var(--careful-color);
            color: white;
            border: 2px solid #047857;
        }
        
        .message-box {
            background-color: #333333;
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .game-container {
                width: 95%;
            }
            h1 {
                font-size: 2rem;
            }
            .info-bar {
                font-size: 1rem;
            }
            .inventory-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Auto TirdzniecÄ«bas Simulators (ReÄlistiskÄks)</h1>
        <p class="text-gray-600 mb-4">PÄ“rc, remontÄ“, un strateÄ£iski gaidi labÄko tirgus brÄ«di. Esi labs dÄ«leris!</p>

        <!-- Money & Market Display -->
        <div class="info-bar">
            <span id="moneyDisplay">Nauda: $1000</span>
            <span id="slotDisplay">Noliktava: 0 / 3</span>
        </div>
        
        <!-- Market Trend Display -->
        <div id="marketTrendDisplay" class="info-card market-normal">
            Tirgus StÄvoklis: NormÄls ğŸ“Š (PÄrdoÅ¡anas Cenas: 100%)
        </div>

        <!-- Global Action Buttons (Buy & Wait) -->
        <div class="flex flex-wrap justify-center mt-6 mb-4 gap-4">
            <button id="buyButton" class="action-button buy-btn text-lg" style="min-width: 200px;">
                Pirkt Jaunu Auto
            </button>
            <button id="waitButton" class="action-button wait-btn text-lg" style="min-width: 200px;">
                Gaidi un IzpÄ“ti Tirgu
            </button>
        </div>

        <!-- Inventory List -->
        <h2 class="text-xl font-bold text-gray-700 mt-4 mb-2">JÅ«su Noliktava (Max ${MAX_INVENTORY} auto)</h2>
        <div id="inventoryList" class="inventory-grid">
            <!-- Auto kartÄ«tes tiks Ä£enerÄ“tas Å¡eit -->
        </div>
        <div id="emptySlotMessage" class="text-gray-500 mt-4">
            Noliktava ir tukÅ¡a. Spiediet "Pirkt Jaunu Auto".
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="message-box">
            Laipni lÅ«dzam! Tavs mÄ“rÄ·is ir nopelnÄ«t $10,000.
        </div>
    </div>

    <script type="text/javascript">
        // --- SpÄ“les Dati un StÄvoklis ---
        
        const MAX_INVENTORY = 3;
        const GOAL = 10000;
        const DILER_FEE = 150; // FiksÄ“ta dÄ«lera maksa par pirkumu
        const FUEL_COST = 30; // BraukÅ¡anas izmaksas
        const INSURANCE_COST = 50; // ApdroÅ¡inÄÅ¡anas izmaksas par auto/gÄjienu
        
        // Auto stÄvokÄ¼a definÄ«cijas un remonta izmaksas
        const conditions = [
            { level: 1, name: "SarÅ«sÄ“jis ğŸŒ", buyFactor: 0.6, sellFactor: 0.8, repairCost: 400, nextCostText: " ($400)" },
            { level: 2, name: "Nolietots ğŸ› ï¸", buyFactor: 0.8, sellFactor: 1.1, repairCost: 250, nextCostText: " ($250)" },
            { level: 3, name: "Lietots ğŸ‘", buyFactor: 1.0, sellFactor: 1.4, repairCost: 150, nextCostText: " ($150)" },
            { level: 4, name: "Laba StÄvoklÄ« âœ¨", buyFactor: 1.2, sellFactor: 1.7, repairCost: 100, nextCostText: " ($100)" },
            { level: 5, name: "Perfekts ğŸ’", buyFactor: 1.5, sellFactor: 2.0, repairCost: 0, nextCostText: " (MaksimÄlais)" },
        ];

        const carModels = [
            { name: "Mazais DÅ¾ips", emoji: "ğŸš™", baseValue: 500, degradationRisk: 0.35, marketChangeBoost: 0.1 },
            { name: "Sporta Auto", emoji: "ğŸï¸", baseValue: 1200, degradationRisk: 0.50, marketChangeBoost: 0.2 },
            { name: "Ä¢imenes Furgons", emoji: "ğŸšŒ", baseValue: 800, degradationRisk: 0.25, marketChangeBoost: 0.05 },
            { name: "Veca MaÅ¡Ä«na", emoji: "ğŸš—", baseValue: 300, degradationRisk: 0.60, marketChangeBoost: 0.15 },
            { name: "Ä€trÄ Rakete", emoji: "ğŸš€", baseValue: 2500, degradationRisk: 0.55, marketChangeBoost: 0.25 },
        ];
        
        // Tirgus tendences
        const marketTrends = {
            boom: { name: "BÅ«ms! ğŸš€", factor: 1.25, colorClass: "market-boom", factorText: "125%" },
            normal: { name: "NormÄls ğŸ“Š", factor: 1.0, colorClass: "market-normal", factorText: "100%" },
            crisis: { name: "KrÄ«ze ğŸ“‰", factor: 0.80, colorClass: "market-crisis", factorText: "80%" },
        };

        let money = 1000;
        let inventory = []; 
        let marketTrend = 'normal'; 

        // --- UI Elementi ---

        const moneyDisplay = document.getElementById('moneyDisplay');
        const slotDisplay = document.getElementById('slotDisplay');
        const marketTrendDisplay = document.getElementById('marketTrendDisplay');
        const buyButton = document.getElementById('buyButton');
        const waitButton = document.getElementById('waitButton');
        const inventoryList = document.getElementById('inventoryList');
        const emptySlotMessage = document.getElementById('emptySlotMessage');
        const messageBox = document.getElementById('messageBox');

        // --- PalÄ«gfunkcijas ---

        /** Atrod stÄvokÄ¼a objektu pÄ“c lÄ«meÅ†a. */
        function getCondition(level) {
            const safeLevel = Math.max(1, Math.min(5, level));
            return conditions.find(c => c.level === safeLevel) || conditions[0];
        }

        /** Atjauno tirgus tendences UI. */
        function updateMarketTrendUI() {
            const trend = marketTrends[marketTrend];
            marketTrendDisplay.className = `info-card ${trend.colorClass}`;
            marketTrendDisplay.textContent = `Tirgus StÄvoklis: ${trend.name} (PÄrdoÅ¡anas Cenas: ${trend.factorText})`;
        }
        
        /** NejauÅ¡i maina tirgus tendenci ar papildu iespÄ“ju uzlabot/pasliktinÄt. */
        function changeMarketTrend(boost = 0) {
            const trends = Object.keys(marketTrends);
            let randomIndex;
            
            if (boost > 0 && Math.random() < boost) {
                // MÄ“Ä£ina virzÄ«t uz BÅ«mu (Boom)
                randomIndex = 0; 
                marketTrend = trends[randomIndex];
            } else if (boost < 0 && Math.random() < Math.abs(boost)) {
                // MÄ“Ä£ina virzÄ«t uz KrÄ«zi (Crisis)
                randomIndex = 2; 
                marketTrend = trends[randomIndex];
            } else {
                // NejauÅ¡a maiÅ†a
                randomIndex = Math.floor(Math.random() * trends.length);
                marketTrend = trends[randomIndex];
            }
            
            updateMarketTrendUI();
            return marketTrends[marketTrend].name; // AtgrieÅ¾ jauno stÄvokli ziÅ†ojumam
        }


        /** Ä¢enerÄ“ nejauÅ¡i svÄrstÄ«gu cenu. */
        function generatePrice(baseValue, conditionLevel, priceType) {
            const condition = getCondition(conditionLevel);
            let factor;
            let multiplier;

            if (priceType === 'buy') {
                // PirkÅ¡anas faktors: svÄrstÄs ap bÄzes cenu + dÄ«lera maksa
                factor = condition.buyFactor;
                multiplier = factor * (0.85 + Math.random() * 0.2); 
            } else {
                // PÄrdoÅ¡anas faktors: ar tirgus tendences faktoru
                factor = condition.sellFactor * marketTrends[marketTrend].factor;
                multiplier = factor * (0.9 + Math.random() * 0.2); 
            }
            return Math.max(100, Math.round(baseValue * multiplier / 10) * 10); 
        }

        /** Atjauno naudas un inventÄra informÄciju UI. */
        function updateUI() {
            moneyDisplay.textContent = `Nauda: $${money.toFixed(0)}`;
            slotDisplay.textContent = `Noliktava: ${inventory.length} / ${MAX_INVENTORY}`;

            // PÄrbauda uzvaru/zaudÄ“jumu
            if (money >= GOAL) {
                showMessage(`APSVEICAM! Tu esi sasniedzis mÄ“rÄ·i un nopelnÄ«jis $${GOAL.toFixed(0)}!`, 'var(--secondary-color)');
                buyButton.disabled = true;
                waitButton.disabled = true;
            } else if (money <= 0) {
                 showMessage(`BANKROTS! Tev beidzÄs nauda! SpÄ“le beigusies.`, 'var(--primary-color)');
                 buyButton.disabled = true;
                 waitButton.disabled = true;
            } else {
                // PirkÅ¡anas pogas stÄvoklis
                const minBuyCost = 100 + DILER_FEE; // MinimÄlÄ pirkÅ¡anas cena + maksa
                const canBuy = inventory.length < MAX_INVENTORY && money >= minBuyCost;
                buyButton.disabled = !canBuy;
                buyButton.textContent = canBuy ? `Pirkt Jaunu Auto (+ $${DILER_FEE} dÄ«lera maksa)` : 
                                      (inventory.length >= MAX_INVENTORY ? "Noliktava Pilna" : `PÄrÄk Maz Naudas ($${minBuyCost} min.)`);
                
                // GaidÄ«Å¡anas pogas stÄvoklis un teksta atjauninÄÅ¡ana
                const totalWaitCost = 10 + inventory.length * INSURANCE_COST;
                waitButton.disabled = money < totalWaitCost;

                let waitText = `Gaidi un IzpÄ“ti Tirgu ($${10} izpÄ“te`;
                if (inventory.length > 0) {
                    waitText += ` + $${inventory.length * INSURANCE_COST} apdroÅ¡inÄÅ¡ana)`;
                } else {
                    waitText += ")";
                }
                waitButton.textContent = waitText;
            }
            
            renderInventory();
        }

        /** Dinamiski atjauno noliktavas sarakstu. */
        function renderInventory() {
            inventoryList.innerHTML = '';

            if (inventory.length === 0) {
                emptySlotMessage.classList.remove('hidden');
            } else {
                emptySlotMessage.classList.add('hidden');
            }

            inventory.forEach((car, index) => {
                const condition = getCondition(car.currentConditionLevel);
                const repairCost = condition.repairCost;
                const estimatedSellPrice = generatePrice(car.baseValue, car.currentConditionLevel, 'sell');
                
                const canRepair = car.currentConditionLevel < 5 && money >= repairCost;
                const repairButtonText = car.currentConditionLevel < 5 
                                        ? `RemontÄ“t ${condition.nextCostText}`
                                        : "Perfekts";
                
                let profitColor = 'text-gray-600';
                if (estimatedSellPrice > car.buyPrice * 1.5) {
                    profitColor = 'text-green-600 font-bold'; 
                } else if (estimatedSellPrice > car.buyPrice) {
                    profitColor = 'text-green-400 font-semibold'; 
                } else if (estimatedSellPrice < car.buyPrice) {
                    profitColor = 'text-red-600 font-bold'; 
                }

                // BraukÅ¡anas izmaksas tagad ietver arÄ« apdroÅ¡inÄÅ¡anu, jo tas prasa laiku
                const totalDriveCost = FUEL_COST + INSURANCE_COST;
                const canDrive = money >= totalDriveCost;

                const carCardHTML = `
                    <div class="car-card">
                        <div class="car-emoji">${car.emoji}</div>
                        <p class="font-bold text-xl">${car.name}</p>
                        <p class="text-xs text-gray-500">Pirkts par: $${car.buyPrice.toFixed(0)}</p>
                        <p class="font-semibold mt-1">StÄvoklis: ${condition.name}</p>
                        <p class="text-sm ${profitColor}">PÄrdoÅ¡anas PotenciÄls: $${estimatedSellPrice.toFixed(0)}</p>
                        
                        <div class="flex flex-wrap justify-center mt-3">
                            <button class="action-button repair-btn" 
                                onclick="handleRepair(${index})" 
                                ${!canRepair || car.currentConditionLevel === 5 ? 'disabled' : ''}>
                                ${repairButtonText}
                            </button>
                        </div>
                        
                        <div class="flex flex-wrap justify-center mt-3 border-t pt-3 border-gray-300">
                             <span class="text-xs font-bold text-gray-600 w-full mb-1">BraukÅ¡ana ($${totalDriveCost} - degviela + apdroÅ¡.)</span>
                            <button class="action-button careful-btn" 
                                onclick="handleDrive(${index}, 'careful')" 
                                ${!canDrive ? 'disabled' : ''}>
                                UzmanÄ«gi
                            </button>
                             <button class="action-button aggressive-btn" 
                                onclick="handleDrive(${index}, 'aggressive')" 
                                ${!canDrive ? 'disabled' : ''}>
                                AgresÄ«vi
                            </button>
                            <button class="action-button sell-btn w-full mt-2" 
                                onclick="handleSell(${index})">
                                PÄrdot ($${estimatedSellPrice.toFixed(0)})
                            </button>
                        </div>
                    </div>
                `;
                inventoryList.insertAdjacentHTML('beforeend', carCardHTML);
            });
        }


        /** ParÄda ziÅ†ojumu ekrÄnÄ. */
        function showMessage(text, color = '#333333') {
            messageBox.textContent = text;
            messageBox.style.backgroundColor = color;
        }

        /** IzvÄ“las nejauÅ¡u auto modeli. */
        function getRandomCarModel() {
            const randomIndex = Math.floor(Math.random() * carModels.length);
            return carModels[randomIndex];
        }

        // --- SpÄ“les LoÄ£ika ---

        /** ApstrÄdÄ pogas "Gaidi un IzpÄ“ti Tirgu" notikumu. */
        function handleWait() {
            const researchCost = 10;
            const totalInsuranceCost = inventory.length * INSURANCE_COST;
            const totalCost = researchCost + totalInsuranceCost;
        
             if (money < totalCost) {
                showMessage(`Tev nav pietiekami daudz naudas, lai izpÄ“tÄ«tu tirgu un segtu apdroÅ¡inÄÅ¡anu! NepiecieÅ¡ami $${totalCost.toFixed(0)}.`, 'var(--primary-color)');
                return;
            }
            money -= totalCost; 

            const newTrendName = changeMarketTrend(); 
            
            let message = `Tu pavadÄ«ji laiku, pÄ“tot tirgu, iztÄ“rÄ“jot $${researchCost} par izpÄ“ti.`;
            if (inventory.length > 0) {
                 message += ` Par ${inventory.length} auto apdroÅ¡inÄÅ¡anu samaksÄti $${totalInsuranceCost}.`;
            }
            
            showMessage(`${message} Tirgus stÄvoklis mainÄ«jÄs uz ${newTrendName}.`, 'var(--drive-color)');
            updateUI();
        }


        /** ApstrÄdÄ pogas "Braukt" notikumu. */
        function handleDrive(index, style) {
            const car = inventory[index];
            const carModel = carModels.find(m => m.name === car.name);
            if (!car || !carModel) return;

            // BraukÅ¡anas izmaksas tagad ietver arÄ« apdroÅ¡inÄÅ¡anu
            const totalDriveCost = FUEL_COST + INSURANCE_COST;

            if (money < totalDriveCost) {
                showMessage(`Tev nav pietiekami daudz naudas ($${totalDriveCost}) degvielai un apdroÅ¡inÄÅ¡anai, lai brauktu!`, 'var(--primary-color)');
                return;
            }

            money -= totalDriveCost;
            let message = `Tu devies braucienÄ ar ${car.name} (${car.emoji}). IztÄ“rÄ“ti $${FUEL_COST} degvielÄ un $${INSURANCE_COST} apdroÅ¡inÄÅ¡anÄ.`;
            let messageColor = 'var(--drive-color)';
            
            let degradationRisk = carModel.degradationRisk;
            let marketBoost = 0;

            if (style === 'careful') {
                // UzmanÄ«ga braukÅ¡ana: Samazina risku uz pusi, bet nedod bonusu tirgum
                degradationRisk *= 0.5;
                message += ` Brauciens bija uzmanÄ«gs.`;
                messageColor = 'var(--careful-color)';
            } else if (style === 'aggressive') {
                // AgresÄ«va braukÅ¡ana: Palielina risku, bet dod lielÄku iespÄ“ju mainÄ«t tirgu uz augÅ¡u
                degradationRisk *= 1.5;
                marketBoost = carModel.marketChangeBoost;
                message += ` Brauciens bija agresÄ«vs!`;
                messageColor = 'var(--aggressive-color)';
            }

            // 1. StÄvokÄ¼a pasliktinÄÅ¡anÄs
            let statusChangeMessage = '';
            if (car.currentConditionLevel > 1 && Math.random() < degradationRisk) {
                car.currentConditionLevel -= 1;
                const newCondition = getCondition(car.currentConditionLevel);
                statusChangeMessage = ` DiemÅ¾Ä“l auto stÄvoklis pasliktinÄjÄs uz "${newCondition.name}"!`;
                messageColor = 'orange'; 
            } else {
                statusChangeMessage = ` Labs brauciens! Auto stÄvoklis palika nemainÄ«gs.`;
            }

            // 2. Tirgus maiÅ†a
            const newTrendName = changeMarketTrend(marketBoost); 
            
            // Apvieno ziÅ†ojumus
            showMessage(`${message} ${statusChangeMessage} Tirgus mainÄ«jÄs uz ${newTrendName}.`, messageColor);

            updateUI();
        }

        /** ApstrÄdÄ pogas "Pirkt" notikumu. */
        function handleBuy() {
            const minBuyCost = 100 + DILER_FEE;
            if (inventory.length >= MAX_INVENTORY) {
                showMessage(`Noliktava ir pilna! PÄrdod kÄdu auto, lai atbrÄ«votu vietu.`, 'orange');
                return;
            }
            if (money < minBuyCost) {
                 showMessage(`Nav pietiekami daudz naudas. MinimÄlÄ summa ir $${minBuyCost}.`, 'var(--primary-color)');
                 return;
            }

            const model = getRandomCarModel();
            const initialConditionLevel = Math.floor(Math.random() * 4) + 1; 
            const buyPrice = generatePrice(model.baseValue, initialConditionLevel, 'buy');
            const totalCost = buyPrice + DILER_FEE;
            const initialCondition = getCondition(initialConditionLevel);

            if (money >= totalCost) {
                money -= totalCost;
                inventory.push({
                    name: model.name,
                    emoji: model.emoji,
                    baseValue: model.baseValue,
                    buyPrice: buyPrice,
                    currentConditionLevel: initialConditionLevel,
                });
                
                // PÄ“c pirkuma, tirgus tendence mainÄs (laiks paiet)
                const newTrendName = changeMarketTrend();

                showMessage(`Tu nopirki ${model.name} (${model.emoji}) par $${buyPrice.toFixed(0)} plus $${DILER_FEE} dÄ«lera maksa. SÄkuma stÄvoklis: "${initialCondition.name}". Tirgus mainÄ«jÄs uz ${newTrendName}.`, 'var(--secondary-color)');
            } else {
                showMessage(`Nav pietiekami daudz naudas. Å is auto maksÄ $${totalCost.toFixed(0)}, bet Tev ir tikai $${money.toFixed(0)}.`, 'var(--primary-color)');
            }

            updateUI();
        }

        /** ApstrÄdÄ pogas "RemontÄ“t" notikumu. */
        function handleRepair(index) {
            const car = inventory[index];
            if (!car || car.currentConditionLevel >= 5) return;

            const currentCondition = getCondition(car.currentConditionLevel);
            const cost = currentCondition.repairCost;

            if (money >= cost) {
                money -= cost;
                car.currentConditionLevel += 1;
                const newCondition = getCondition(car.currentConditionLevel);
                
                showMessage(`Tu ieguldÄ«ji $${cost.toFixed(0)} remontÄ. Auto stÄvoklis uzlabots uz "${newCondition.name}"!`, 'var(--repair-color)');
            } else {
                showMessage(`Remontam nepiecieÅ¡ami $${cost.toFixed(0)}, bet Tev ir tikai $${money.toFixed(0)}.`, 'var(--primary-color)');
            }

            updateUI();
        }

        /** ApstrÄdÄ pogas "PÄrdot" notikumu. */
        function handleSell(index) {
            const car = inventory[index];
            if (!car) return;

            const sellPrice = generatePrice(car.baseValue, car.currentConditionLevel, 'sell');
            money += sellPrice;

            const profit = sellPrice - car.buyPrice;
            const finalConditionName = getCondition(car.currentConditionLevel).name;

            inventory.splice(index, 1);

            // PÄ“c pÄrdoÅ¡anas, tirgus tendence var nedaudz mainÄ«ties
            const newTrendName = changeMarketTrend(); 

            if (profit > 0) {
                showMessage(`APSVEICAM! Tu pÄrdevi ${car.name} (${finalConditionName}) par $${sellPrice.toFixed(0)} un nopelnÄ«ji $${profit.toFixed(0)} (neskaitot remontus)! Tirgus mainÄ«jÄs uz ${newTrendName}.`, 'var(--secondary-color)');
            } else {
                showMessage(`Ak, nÄ“! Tu pÄrdevi ${car.name} par $${sellPrice.toFixed(0)}. Tu zaudÄ“ji $${Math.abs(profit).toFixed(0)} (pirkuma cenas starpÄ«ba). Tirgus mainÄ«jÄs uz ${newTrendName}.`, 'var(--primary-color)');
            }

            updateUI();
        }
        
        // --- PasÄkumu KlausÄ«tÄji (Event Listeners) ---

        buyButton.addEventListener('click', handleBuy);
        waitButton.addEventListener('click', handleWait);

        // --- SÄkuma InicializÄcija ---
        
        /** InicializÄ“ spÄ“les stÄvokli */
        function initializeGame() {
            changeMarketTrend(); 
            updateUI();
        }

        window.onload = initializeGame;

    </script>
</body>
</html>

